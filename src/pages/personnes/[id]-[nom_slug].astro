---
import Layout from "../../layouts/Layout.astro";
const { id, nom_slug } = Astro.params;
const personne = await Astro.locals.pb.collection("Personne").getOne(id);
export const prerender = false;
const isLoggedIn = Astro.locals.pb.authStore.isValid;
---

<Layout>
    <h1>{personne.nom}</h1>
    <p>
        Date de naissance: {
            new Date(personne.date_de_naissance).toLocaleDateString("fr-FR")
        }
    </p>
    {
        personne.date_de_deces && (
            <p>
                Date de décès:{" "}
                {new Date(personne.date_de_deces).toLocaleDateString("fr-FR")}
            </p>
        )
    }
    <p>
        Âge: {
            (() => {
                const birth = new Date(personne.date_de_naissance);
                const endDate = personne.date_de_deces
                    ? new Date(personne.date_de_deces)
                    : new Date();
                let age = endDate.getFullYear() - birth.getFullYear();
                const monthDiff = endDate.getMonth() - birth.getMonth();
                if (
                    monthDiff < 0 ||
                    (monthDiff === 0 && endDate.getDate() < birth.getDate())
                ) {
                    age--;
                }
                return age;
            })()
        } ans
    </p>
    <p>Profession: {personne.proffession?.join(", ") || "Non spécifiée"}</p>
    {isLoggedIn && (
        <p>
            <a href={`/personnes/edit/${id}-${nom_slug}`}>Editer</a>
        </p>
    )}
    <a href="/personnes">Retour à la liste des personnes</a>
</Layout>

